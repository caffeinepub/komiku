{
  "kind": "build_request",
  "title": "Frontend-side chapter grabbing using allorigins.win with fallback",
  "projectName": "KOMIKU",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-18",
      "text": "Refactor the Chapter Grabbing UI in the admin panel (ChapterGrabbingPage.tsx) to perform HTML fetching entirely on the frontend instead of calling the backend grabComicPages function. Use 'https://api.allorigins.win/get?url=<encoded_url>' as the primary proxy: send the admin-entered source URL through allorigins.win, parse the returned HTML content to extract image URLs (img tags matching common manga page patterns such as large images, numbered filenames, and CDN paths). If the allorigins.win request fails (network error, non-200 status, or timeout), automatically fall back to a secondary proxy (e.g., 'https://corsproxy.io/?<encoded_url>') and attempt the same HTML extraction. If both proxies fail, display a clear error message to the admin. After successful extraction, display the discovered image URLs as a preview grid showing the actual images, allow the admin to reorder or remove unwanted images, then save the confirmed page list as a new chapter (still using the existing backend mutation for saving).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-8",
          "msg-9",
          "msg-10",
          "msg-11"
        ],
        "quotes": [
          "gunakan API allorigins.win",
          "Fitur ini hanya untuk grabbing halaman komik, gunakan sebagai frontend, jika gagal gunakan metode lain",
          "Fetch konten HTML dari URL sumber via https://api.allorigins.win/get?url=<encoded_url> langsung dari React/TypeScript",
          "Jika allorigins.win gagal (error/timeout), fallback ke proxy alternatif"
        ]
      },
      "acceptanceCriteria": [
        "The ChapterGrabbingPage no longer calls the backend grabComicPages function for fetching page content.",
        "Entering a source URL and clicking grab sends a request to https://api.allorigins.win/get?url=<encoded_url> from the frontend.",
        "The response HTML is parsed client-side to extract img tag URLs matching manga page patterns.",
        "If allorigins.win returns an error or times out, the UI automatically retries via a fallback proxy (e.g., corsproxy.io).",
        "If both proxies fail, an informative error message is displayed to the admin.",
        "Successfully extracted image URLs are displayed as a preview grid showing the actual images.",
        "Admin can reorder and remove images from the preview grid before saving.",
        "Saving the confirmed page list still calls the existing backend chapter creation mutation.",
        "The scope of this change is limited to the Chapter Grabbing UI only."
      ]
    }
  ],
  "constraints": [
    "Do not modify any backend Motoko functions â€” all changes are frontend-only.",
    "The existing chapter save/create backend mutation must remain in use for persisting the final page list.",
    "Scope is limited to ChapterGrabbingPage.tsx only; no other pages should be affected."
  ],
  "nonGoals": [
    "Changing any other admin panel pages or features.",
    "Using allorigins.win or any proxy for purposes other than chapter grabbing.",
    "Modifying backend grabComicPages function.",
    "Changing the public-facing frontend pages."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}